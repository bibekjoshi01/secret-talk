<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Secret Chat</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', path='/css/chat.css') }}"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="icon"
      type="image/x-icon"
      href="{{ url_for('static', path='/icons/favicon.png') }}"
    />
  </head>
  <body>
    <!-- chat info modal -->
    <div id="chatLinkModal" class="modal">
      <div class="modal-content">
        <button class="close-btn" onclick="closeChatLinkModal()">
          <i class="fa fa-times" aria-hidden="true"></i>
        </button>
        <h3>Share this Chat Room Link</h3>
        <div class="input-wrapper">
          <input type="text" id="chat-link" readonly value="{{ share_url }}" />
          <button class="copy-btn" onclick="copyChatLink()">
            <i class="fa fa-clipboard" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="chat-header">
        <div class="header-left">
          Active Users: <span id="active-users">0</span>
        </div>
        <div class="header-center">
          Hello <strong id="username">Anonymous</strong>
        </div>
        <div class="header-right">
          <button id="info-button" onclick="openChatLinkModal()">
            <i class="fa fa-info-circle" aria-hidden="true"></i>
          </button>
        </div>
      </div>

      <div class="chat-wrapper">
        <div id="chat-container">
          <ul id="messages"></ul>
        </div>

        <div id="input-area">
          <input id="msg" placeholder="Type a message..." autocomplete="off" />
          <input
            type="file"
            id="attachmentInput"
            style="display: none"
            multiple
          />
          <button
            class="btn attachment"
            onclick="document.getElementById('attachmentInput').click()"
          >
            <i class="fa fa-paperclip" aria-hidden="true"></i>
          </button>
          <button id="send-btn" class="btn send" onclick="send()">
            <i class="fa fa-paper-plane" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>

    <script>
      const attachmentInput = document.getElementById("attachmentInput");

      attachmentInput.addEventListener("change", () => {
        const files = attachmentInput.files;
        if (files.length > 0) {
          console.log("Selected files:", files);
          // ðŸš¨ TODO: upload or send the files here
          Array.from(files).forEach((file) => console.log(file.name));
        }
      });
    </script>

    <script>
      function openChatLinkModal() {
        document.getElementById("chatLinkModal").style.display = "flex";
      }

      function closeChatLinkModal() {
        document.getElementById("chatLinkModal").style.display = "none";
      }

      function copyChatLink() {
        const linkInput = document.getElementById("chat-link");
        const copyBtn = document.querySelector(".copy-btn");
        const originalValue = linkInput.value;

        linkInput.select();
        linkInput.setSelectionRange(0, 99999);
        navigator.clipboard.writeText(linkInput.value);
        linkInput.value = "Link Copied To Clipboard!";
        copyBtn.style.display = "none";
        setTimeout(() => {
          linkInput.value = originalValue;
          copyBtn.style.display = "inline-block";
        }, 2000);
      }
    </script>
    <script>
      window.chatConfig = {
        chatId: "{{ chat_id }}",
        wsBaseUrl: "{{ ws_base_url }}",
        username: "{{ username or '' }}",
      };
    </script>
    <script defer src="{{ url_for('static', path='/js/chat.js') }}"></script>
  </body>
</html>
